var TableBuilder=function(){function n(n,t,i){this.dimension=n,this.parentElementId=t,this.editor=i,this.parentElement=document.getElementById(t),this.tableElement=this.createTable(),this.headerRow=this.createRow(),this.leftTopElement=this.createHeaderElement(this.headerRow),this.setHeaderElementValue(this.leftTopElement,n+"/"+n),this.lastAddedCell={row:0,col:0},this.currentRow=null}return n.prototype.createTable=function(){var n=document.createElement("table");return this.parentElement.appendChild(n),n},n.prototype.createRow=function(n){typeof n=="undefined"&&(n=!1);var t=document.createElement("tr");return this.tableElement.appendChild(t),this.lastAddedCell&&(this.lastAddedCell.row++,this.createRowCaption(t)),t},n.prototype.createRowCaption=function(n){var t=document.createElement("th");n.appendChild(t),t.innerText=this.lastAddedCell.row.toString()},n.prototype.createCell=function(n,t){var i,r;return typeof t=="undefined"&&(t=!1),this.lastAddedCell.row==1&&this.lastAddedCell.col<this.dimension&&(i=document.createElement("th"),this.headerRow.appendChild(i),i.innerText=(this.lastAddedCell.col+1).toString()),r=document.createElement("td"),n.appendChild(r),this.lastAddedCell.col++,r},n.prototype.createHeaderElement=function(n){var t=document.createElement("th");return n.appendChild(t),t},n.prototype.setHeaderElementValue=function(n,t){n.innerHTML=t},n.prototype.addCell=function(n,t){typeof t=="undefined"&&(t=!1),(this.lastAddedCell==null||this.lastAddedCell==undefined)&&(this.lastAddedCell={row:0,col:0}),(this.lastAddedCell.row==0||this.lastAddedCell.col==this.dimension)&&(this.currentRow=this.createRow(),this.lastAddedCell.col=0,t&&this.editor.matrix.elements.push([]));var i=this.createCell(this.currentRow);t&&this.editor.matrix.elements[this.lastAddedCell.row-1].push(n),this.setCellStyle(i,n),this.setCellEvents(i),i.id=this.getCellId(this.lastAddedCell.row,this.lastAddedCell.col),i.innerHTML=parseFloat(n).toFixed(4)},n.prototype.setCellStyle=function(n,t){n.setAttribute("contenteditable","true");var i=Math.abs(t);t<0?(n.style.background="rgba(255, 140, 0,"+i+")",n.style.color="rgb(0,0,0)"):t==0?(n.style.background="rgb(255, 255, 255)",n.style.color="rgb(0,0,0)"):(n.style.background="rgba(0, 0, 0,"+i+")",n.style.color=this.getCellTextColor(t)),n.width="10",n.setAttribute("align","right")},n.prototype.getCellTextColor=function(n){return n>.6?"rgb(255, 140, 0)":n>.3?"rgb(255, 255, 0)":"rgb(0, 130, 0)"},n.prototype.getCellId=function(n,t){return"id"+n+"_"+t},n.prototype.setCellEvents=function(n){var t=this;n.onfocus=function(n){t.editor.collapsed||(t.editor.currentSelectedValue=n.target.innerText)},n.onblur=function(n){var i,r,u;if(t.editor.collapsed){n.target.innerText="";return}t.isCorrectNumber(n.target.innerText)?(i=parseFloat(n.target.innerText),n.target.innerText=i.toFixed(4),t.setCellStyle(n.target,i),r=n.target.cellIndex-1,u=n.target.parentNode.sectionRowIndex-1,t.editor.matrix.elements[u][r]=i):n.target.innerText=t.editor.currentSelectedValue}},n.prototype.isCorrectNumber=function(n){return/(-|\+)?[1]|(-|\+)?[0]|^(-|\+)?([0]|[1])[.]?(?:\d{1,4}|\d+)$/.test(n)&&n>=-1&&n<=1},n.prototype.reduceDimension=function(n){var t,i;for(this.editor.matrix.elements=this.editor.matrix.elements.splice(0,n),t=this.editor.matrix.dimension;t>=0;t--)if(t>n)this.tableElement.deleteRow(t);else for(t>0&&(this.editor.matrix.elements[t-1]=this.editor.matrix.elements[t-1].splice(0,n)),i=this.editor.matrix.dimension;i>n;i--)this.tableElement.rows[t].deleteCell(i);this.editor.matrix.dimension=n,this.dimension=n,this.leftTopElement.innerText=n+"/"+n},n.prototype.increaseDimension=function(n){for(var i,r,t=0;t<n;t++)for(i=this.editor.matrix.dimension,t>=this.editor.matrix.dimension&&(this.editor.matrix.elements.push([]),i=0),r=i;r<n;r++)this.editor.matrix.elements[t].push("0.0000");this.editor.matrix.dimension=n,this.dimension=n,this.leftTopElement.innerText=n+"/"+n},n}()